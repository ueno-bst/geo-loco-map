<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <script data-main="GeoLocoMap" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.20/require.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyDys3l0fXuc1b39XjRGoHdhP24N3Ovg1iI"></script>
    <script type="text/javascript" charset="utf-8" src="https://map.yahooapis.jp/js/V1/jsapi?appid=dj00aiZpPU51NkFQOFB5N0hZVSZzPWNvbnN1bWVyc2VjcmV0Jng9MDg-"></script>
    <title>sample</title>
    <style>
        body {
            font-size: .8em;
        }

        dl {
            display: flex;
            font-size: .7rem;
        }

        dl > dt {

        }
    </style>
</head>
<body style="margin: 0; padding: 0;">
<section style="display: flex; width: 100vw; height: 100vh;">
    <div class="map" style="flex-grow: 1"></div>
    <div style="width: 40vw; padding: 1em; display: flex; flex-direction: column;">
        <fieldset style="margin: 0 0 1em 0;">
            <legend>コントロールの表示</legend>
            <label>
                <input type="checkbox" id="ui" value="1"> コントローラー表示
            </label>
            <label>
                <input type="checkbox" id="info" value="1"> バルーン表示
            </label>

            <table>
                <tr>
                    <th><label for="latitude">Lat:</label></th>
                    <td><input id="latitude" type="number" min="-90.00000000" max="90.0000000" step="0.005"></td>
                </tr>
                <tr>
                    <th><label for="longitude">Lng:</label></th>
                    <td><input id="longitude" type="number" min="-180.00000000" max="180.0000000" step="0.005"></td>
                </tr>
                <tr>
                    <th><label for="zoom">Zoom:</label></th>
                    <td><input id="zoom" type="number" min="1" max="20"></td>
                </tr>
                <tr>
                    <th rowspan="4">Bounds:</th>
                    <td><input id="bound-ne" type="number" readonly></td>
                </tr>
                <tr>
                    <td><input id="bound-nw" type="number" readonly></td>
                </tr>
                <tr>
                    <td><input id="bound-se" type="number" readonly></td>
                </tr>
                <tr>
                    <td><input id="bound-sw" type="number" readonly></td>
                </tr>
            </table>
        </fieldset>
        <div style="position:relative; flex-grow: 1;">
            <textarea id="markers" style="position: absolute; left: 0; top: 0; bottom:0; right: 0; width: 100%; box-sizing: border-box;"></textarea>
        </div>
    </div>
</section>
</div>

<!--<script type="text/javascript" src="../dist/bundle.js"></script>-->
<script type="module">
	require(['GeoLocoMap'], function (a) {
		var map = new a.GeoLocoMap({
			map_type: 'yahoo',
			center: [35, 135],
			show_ui: true,
            show_info: false,
			selector: '.map',
			api_url: '/geo-loco-map/src/response.json',
			onMove: function (obj, coordinate) {
				$("#latitude").val(coordinate.lat);
				$("#longitude").val(coordinate.lng);
				console.info("onMove", coordinate.lat, coordinate.lng);
			},
			onZoom: function (obj, zoom) {
				$("#zoom").val(zoom);
				console.info("onZoom", zoom);
			},
			onInit: function (e) {
			},
			onChange: function (c) {
				var b = map.getBounds();

				if (b) {
					$("#bound-ne").val(b.ne.lat);
					$("#bound-nw").val(b.ne.lng);
					$("#bound-se").val(b.sw.lat);
					$("#bound-sw").val(b.sw.lng);
				}

				var
					m = map.getViewInMarkers(),
					t = "";

				for (var i = 0; i < m.length; i++) {
					t = t + m[i].id + " : " + m[i].label + "\n";
				}

				$("#markers").val(t);
			},
			onUI: function (obj, f) {
				$("#ui").prop("checked", f);
			},
            onClickMarker: function(f) {
				console.info(f);
				alert(f.label);
            },
		});

		$("#ui").on("change", function () {
			map.setUI($("#ui:checked").length > 0);
		});

		var centerTimer;
		$("#latitude, #longitude").on("change input", function () {
			clearTimeout(centerTimer);
			centerTimer = setTimeout(function () {
				map.setCenter($("#latitude").val(), $("#longitude").val());
			}, 100);
		});

		var zoomTimer;
		$("#zoom").on("change input", function () {
			clearTimeout(zoomTimer);
			zoomTimer = setTimeout(function () {
				map.setZoom($("#zoom").val());
			}, 100);
		});

		map.addMarker({
			coordinate: [34.6675858, 133.8958007],
			label: "岡山県のてけとーな場所",
			description: "AAA<strong>A</strong>AA",
			description_format: "text",
		});

		map.addMarker({
			id: "temp",
			label: "花屋敷へそ公園店",
			coordinate: [35.000277, 134.9986654],
			description: "AAA<strong>A</strong>AA",
			description_format: "text",
		});

		// map.removeMarker("temp");
	});

</script>
</body>

</html>
